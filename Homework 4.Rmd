---
title: "Time Series: Homework 4"
author: "Paul Harmon and Jacob Dym and Justin Gomez"
date: "September 21, 2016"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
---
_Report all R code either inline or in an appendix._

1) _Provide a reason for your choice of location. Report any missing observations and the range of years where you are modeling._
    We chose a location in Australia (CGO) called Cape Grim, which is the northern-most point of Tasmania.  According to the station's website (managed by Massachussetts Institute of Technology), the station there is located in the path of large air masses that settle over Antarctica and the Southern Ocean that surrounds it. Thus, measurements taken there tend to give some information about CO2 concentrations in less accessible places such as the South Pole. 
    The dataset contains observations over a 21 year period from 1984 to 2015. Thankfully, there were no missing observations in the dataset.

```{r, include=FALSE}
CGO <- read.table("ftp://aftp.cmdl.noaa.gov/data/trace_gases/co2/flask/surface/co2_cgo_surface-flask_1_ccgg_month.txt",header=T)
colnames(CGO) = c("Site", "Year", "Month", "Value")

BMonth <- NULL
MI <- NULL
for(i in 1:12){
  MI <- as.numeric(CGO[,3])
  BMonth[i] <- sum(subset(MI,MI==i))
}
BMonth <- as.matrix(BMonth)
MSum <- NULL
for(i in 1:12){
  MSum[i] <- BMonth[i]/i
}
#Gives the number of observations in the data for each month 1=January, 12=December
MSum <- as.matrix(MSum)
CGOts<-ts(CGO$Value,start=c(1984,5),freq=12)
```

2) _Make a nice looking time series plot of the CO$2$ concentrations._
```{r}
plot(CGOts, col = "hotpink3", lwd = 2, main = "Carbon Dioxide Concentration over Time")
```

3) _Fit a linear trend plus seasonal means model to the data. Report and discuss the four panel residual diagnostics. Also make a plot of residuals vs time and discuss any potential missed pattern versus time._
```{r}
#Not sure if this is exactly what he wants given the "seasonal means model"
YearF <- as.vector(time(CGOts))
MonthF <- as.factor(cycle(CGOts))
LmYM <- lm(CGO$Value~YearF + MonthF)
plot(LmYM)

plot(residuals(LmYM)~YearF)
CGO.lm<-lm(CGO$Value~YearF + MonthF)
par(mfrow=c(2,2))
plot(CGO.lm)
par(mfrow=c(1,1))
plot(CGO.lm$residuals~YearF,ylab="Residuals",xlab="Time")
```

4) _Provide tests for the linear and seasonal means components, conditional on each other. Report those results in two sentences including all details._
```{r}
LS.lm <- lm(CGO$Value~ YearF + MonthF + YearF*MonthF)
plot(LS.lm)
anova(LS.lm)
require(car)
Anova(LS.lm,type=2)
Anova(LS.lm,type=3)
```


5) _For your model, plot the original time series and the model fitted values, both versus time on the same plot. You might consider two line types or colors for the two lines. The easiest way to obtain fitted values in R is using fitted(modelname). Discuss how it appears your model does or does not describe the responses using this plot._

```{r}
plot(CGO$Value~YearF,type="l")
fits<-fitted(CGO.lm)
lines(fits~YearF,type="l",col="blue")
```

6) _Document your R version._

```{r}
getRversion()
sessionInfo()$R.version$nickname
```








